#!/bin/bash -eu

if [ $# -ne 1 ]; then
  echo "You must provide a target ENV"
  echo "usage: $0 [ stack ] eg. $0 integration"
  exit 1
fi

TARGET=$1
BUCKET=s3://myob-sme-web-ui-$TARGET-bucket

# Get the build artefact
# buildkite-agent artifact download build-$TARGET.tar.gz .
tar -zxvf build-$TARGET.tar.gz

# Deploy it
aws s3 cp build/ ${BUCKET} --recursive

# Re-deploy index.html without caching in the browser
aws s3 cp build/index.html ${BUCKET} --cache-control max-age=0
