#!/bin/bash -eu
BUILD_IMAGE_URI='590476131038.dkr.ecr.ap-southeast-2.amazonaws.com/sme-web@sha256:0288a404da91e88cdf5979876f47d024d868fbbd6bcba70603edd785795ffc57'

echo "--- Login to ECR"
$(aws ecr get-login --no-include-email --region ap-southeast-2)

echo "--- Start Build Container"
docker run -t  \
   -v $(pwd):/app \
   -w /app \
   -v ~/.aws/credentials:/root/.aws/credentials \
   -e "REACT_APP_BUILD_NUMBER=${REACT_APP_BUILD_NUMBER:-dev}" \
   $BUILD_IMAGE_URI \
   /bin/sh -c "ops/bin/npm-auth && $@"

