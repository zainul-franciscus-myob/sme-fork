#!/bin/bash -eu
BUILD_IMAGE_URI='590476131038.dkr.ecr.ap-southeast-2.amazonaws.com/sme-web@sha256:f08e637f0ae2c563a05de045e9953a62ed6db70f6e14e5a62cb5ccc39ae97ee4'

echo "--- Login to ECR"
$(aws ecr get-login --no-include-email --region ap-southeast-2)

echo "--- Start Build Container"
docker run -t  \
   -v $(pwd):/app \
   -w /app \
   -v ~/.aws/credentials:/root/.aws/credentials \
   -e "REACT_APP_BUILD_NUMBER=${REACT_APP_BUILD_NUMBER:-local}" \
   $BUILD_IMAGE_URI \
   /bin/sh -c "ops/bin/npm-auth && $@"

